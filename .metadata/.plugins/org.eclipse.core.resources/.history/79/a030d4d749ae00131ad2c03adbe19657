package com.ocd.dev.simplegrocerylist;

import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.view.View;
import android.view.ViewGroup;

import com.google.android.glass.app.Card;
import com.google.android.glass.app.Card.ImageLayout;
import com.google.android.glass.widget.CardScrollAdapter;
import com.google.android.glass.widget.CardScrollView;

public class GroceryListActivity extends Activity {
	private CardScrollView mCardScrollView;
	private Card mCard;
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		
		/*
		mCard = new Card(this);
		mCard.setText("Black rasberry chip ice cream");
		mCard.setFootnote("1 of 4");
		mCard.setImageLayout(ImageLayout.FULL);
		mCard.addImage(R.drawable.icecream);
		setContentView(mCard.toView());
		*/
		
		mCardScrollView = new CardScrollView(this);
		
		GroceryItemCards groceryItemCards = new GroceryItemCards(this);
		groceryItemCards.addGroceryItem(new GroceryItem("Black rasberry chip ice cream", R.drawable.icecream));
		groceryItemCards.addGroceryItem(new GroceryItem("potatoes"));
		groceryItemCards.addGroceryItem(new GroceryItem("chicken"));
		groceryItemCards.addGroceryItem(new GroceryItem("rice", R.drawable.rice));
		
		CardScrollAdapter adapter = new ListCardScrollAdapter(groceryItemCards.getCards());
		mCardScrollView.setAdapter(adapter);
		mCardScrollView.activate();
		
		setContentView(mCardScrollView);
	}
	
	public class GroceryItem {
		private String mName;
		private int mImageResource;
		
		public GroceryItem(String name) {
			this(name, -1);
		}
		
		public GroceryItem(String name, int imageResource) {
			mName = name;
			mImageResource = imageResource;
		}
		
		public String getName() {
			return mName;
		}
		
		public int getImageResource() {
			return mImageResource;
		}
	}
	
	public class GroceryItemCards {
		private Context mContext;
		private List<Card> mCards;
		
		public GroceryItemCards(Context context) {
			mContext = context;
			mCards = new ArrayList<Card>();
		}
		
		public void addGroceryItem(GroceryItem groceryItem) {
			Card card = new Card(mContext);
			card.setText(groceryItem.getName());

			if(groceryItem.getImageResource() >= 0) {
				card.addImage(groceryItem.getImageResource());
				card.setImageLayout(ImageLayout.FULL);
			}

			mCards.add(card);
		}
		
		public List<Card> getCards() {
			int numCards = mCards.size();
			for(int i=0; i<numCards; ++i) {
				mCards.get(i).setFootnote(String.format(Locale.US, "%d of %d", i+1, numCards));
			}
			
			return mCards;
		}
	}
	
	private class ListCardScrollAdapter extends CardScrollAdapter {
		private List<Card> mCards;
		
		public ListCardScrollAdapter(List<Card> cards) {
			mCards = cards;
		}

		@Override
		public int findIdPosition(Object id) {
			return -1;
		}

		@Override
		public int findItemPosition(Object item) {
			return mCards.indexOf(item);
		}

		@Override
		public int getCount() {
			return mCards.size();
		}

		@Override
		public Object getItem(int position) {
			return mCards.get(position);
		}

		@Override
		public View getView(int position, View convertView, ViewGroup parent) {
			return mCards.get(position).toView();
		}
		
	}
}
